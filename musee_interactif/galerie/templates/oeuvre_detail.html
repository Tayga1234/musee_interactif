{% extends "base.html" %}
{% load static %}
{% block extra_css %}<link rel="stylesheet" href="{% static 'css/detail.css' %}">{% endblock %}
{% block content %}
<section id="oeuvre-hero" class="py-5 text-white" style="background: linear-gradient(135deg, #4b6cb7, #182848);">
    <div class="container text-center">
        <h1 class="display-4">{{ oeuvre.titre }}</h1>
        <p class="lead">{{ oeuvre.artiste.prenom }} {{ oeuvre.artiste.nom }}</p>
    </div>
</section>

<section class="container py-5">
    <div class="row">
        <!-- Colonne médias -->
        <!-- Colonne médias -->
        <div class="col-lg-6 mb-4">
            {% if oeuvre.image_principale %}
            <div class="main-image mb-3 text-center">
                <img id="main-image" src="{{ oeuvre.image_principale.url }}" class="img-fluid rounded shadow" alt="{{ oeuvre.titre }}" onclick="openFrame('{{ oeuvre.image_principale.url }}')">
            </div>
            {% endif %}

            {% if oeuvre.medias.all %}
            <div class="d-flex flex-wrap justify-content-center gap-2">
                {% for media in oeuvre.medias.all %}
                    {% if media.type == 'image' %}
                    <img src="{{ media.fichier.url }}" class="thumbnail-img rounded shadow-sm" alt="{{ media.legende }}"
                        onclick="openFrame('{{ media.fichier.url }}')">
                    {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            {% if oeuvre.fichier_3d %}
            <div class="my-4">
                <model-viewer src="{{ oeuvre.fichier_3d.url }}"
                    alt="{{ oeuvre.titre }}"
                    auto-rotate
                    camera-controls
                    ar
                    shadow-intensity="1"
                    style="width:100%; height:400px;">
                </model-viewer>
            </div>
            {% endif %}
        </div>


        <!-- Colonne infos -->
        <div class="col-lg-6">
            <h3>Informations</h3>
            <p><strong>Artiste :</strong> {{ oeuvre.artiste.prenom }} {{ oeuvre.artiste.nom }}</p>
            {% if oeuvre.categorie %}
            <p><strong>Catégorie :</strong> {{ oeuvre.categorie.nom }}</p>
            {% endif %}
            {% if oeuvre.annee_creation %}
            <p><strong>Année de création :</strong> {{ oeuvre.annee_creation }}</p>
            {% endif %}
            <p>{{ oeuvre.description }}</p>
            <div class="mt-4">
                <a href="#{% comment %} {% url 'liste_oeuvres' %} {% endcomment %}" class="btn btn-primary me-2">Retour aux œuvres</a>
                <a href="#" class="btn btn-outline-warning">Partager</a>
            </div>
        </div>
    </div>

    <!-- Autres œuvres du même artiste -->
    {% if oeuvre.artiste.oeuvres.count > 1 %}
    <hr class="my-5">
    <h4 class="mb-4">Autres œuvres de {{ oeuvre.artiste.prenom }}</h4>
    <div class="row g-3">
        {% for autre in oeuvre.artiste.oeuvres.all %}
            {% if autre.id != oeuvre.id %}
            <div class="col-md-3 col-sm-6">
                <a href="#{% comment %} {% url 'detail_oeuvre' autre.id %} {% endcomment %}">
                    {% if autre.image_principale %}
                    <img src="{{ autre.image_principale.url }}" class="img-fluid rounded shadow" alt="{{ autre.titre }}">
                    {% endif %}
                    <p class="text-center mt-2">{{ autre.titre }}</p>
                </a>
            </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}
</section>
<!-- Fenêtre d’agrandissement -->
<div id="image-frame" class="image-frame" onclick="closeFrame()">
    <span class="close-btn">&times;</span>
    <img id="frame-img" src="" alt="Agrandissement">
</div>
<script>
function openFrame(url) {
    const frame = document.getElementById("image-frame");
    const img = document.getElementById("frame-img");
    img.src = url;
    frame.style.display = "flex";
}

function closeFrame() {
    document.getElementById("image-frame").style.display = "none";
}
</script>

<!-- Model Viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
{% endblock %}
