{% extends "base.html" %}
{% load static %}
{% load dict_filters %}
{% block page_active_2 %}active{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/detail.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
<style>
/* ===== HERO SECTION ===== */
#expo-hero {
  background: linear-gradient(to bottom, rgba(0,0,0,0.2), rgba(0,0,0,0.65)),
              url('{{ exposition.image_affiche.url }}') center/cover no-repeat;
  min-height: 75vh;
  position: relative;
  color: white;
  transition: all 0.6s ease;
}
#expo-hero:hover {
  transform: scale(1.01);
}
#expo-hero .container {
  animation: fadeInUp 1.2s ease;
}
.text-shadow {
  text-shadow: 0 3px 10px rgba(0,0,0,0.5);
}

/* ===== TRANSITION SOFT ===== */
.section-divider {
  height: 100px;
  background: linear-gradient(to bottom, #fff, #f8f9fa);
  display: flex;
  justify-content: center;
  align-items: center;
}
.section-divider i {
  font-size: 2rem;
  color: #ff7b00;
  animation: float 2.5s infinite ease-in-out;
}

/* ===== SECTION INTERM√âDIAIRE ===== */
#expo-preview {
  background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%);
  transition: all 0.6s ease;
}
#expo-preview h2 {
  color: #ff7b00;
}
.card {
  border: none;
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.4s ease;
}
.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}
.card img {
  height: 300px;
  object-fit: cover;
}
.btn-oeuvre {
  background: linear-gradient(135deg, #ff7b00, #ff914d);
  color: white;
  border-radius: 30px;
  padding: 0.5rem 1.2rem;
  font-size: 1rem;
  transition: all 0.3s ease;
}
.btn-oeuvre:hover {
  background: linear-gradient(135deg, #ff914d, #ff7b00);
  transform: scale(1.05);
}

/* ===== ANIMATIONS ===== */
@keyframes fadeInUp {
  from {opacity: 0; transform: translateY(30px);}
  to {opacity: 1; transform: translateY(0);}
}
@keyframes float {
  0%, 100% {transform: translateY(0);}
  50% {transform: translateY(-8px);}
}
</style>
{% endblock %}

{% block content %}

<!-- ===== HERO EXPOSITION ===== -->
<section id="expo-hero" class="text-center d-flex align-items-center justify-content-center">
  <div class="container position-relative z-1">
    <h1 class="display-3 fw-bold mb-3 text-shadow">{{ exposition.titre }}</h1>
    <p class="lead fs-5 mb-4">{{ exposition.description|truncatewords:25 }}</p>
    <p class="fw-semibold">
      <i class="bi bi-calendar-event me-2"></i>
      Du <strong>{{ exposition.date_debut }}</strong> au <strong>{{ exposition.date_fin }}</strong>
    </p>
  </div>
</section>

<!-- Transition -->
<div class="section-divider">
  <i class="bi bi-stars"></i>
</div>

<!-- ===== SECTION INTERM√âDIAIRE (APER√áU) ===== -->
<section id="expo-preview" class="py-5">
  <div class="container text-center">
    <h2 class="fw-bold mb-4">≈íuvres phares de l‚Äôexposition</h2>
    <p class="text-muted mb-5">
      D√©couvrez quelques ≈ìuvres embl√©matiques avant d‚Äôexplorer la collection compl√®te.
    </p>

    <div class="container py-5">
    <div class="row g-4 justify-content-center">
      {% for oeuvre in oeuvres|slice:":3"%}
      <div class="col-md-4 col-sm-6">
        <div class="card border-0 shadow-lg rounded-4 overflow-hidden position-relative hover-card">
          {% if oeuvre.image_principale %}
          <img src="{{ oeuvre.image_principale.url }}" class="img-fluid" alt="{{ oeuvre.titre }}">
          {% endif %}
          <div class="card-overlay d-flex flex-column justify-content-center align-items-center text-white text-center p-4">
            <h5 class="fw-bold">{{ oeuvre.titre }}</h5>
            <p class="small">{{ oeuvre.description|truncatewords:15 }}</p>
            <a href="{% url 'galerie:detail_oeuvre' oeuvre.id %}" class="btn btn-light btn-sm mt-2">
              <i class="bi bi-eye"></i> Voir plus
            </a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

    <style>
    .hover-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .hover-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    .card-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.6);
      opacity: 0;
      transition: opacity 0.4s ease;
    }
    .hover-card:hover .card-overlay {
      opacity: 1;
    }
    </style>

  </div>
</section>

<!-- Transition -->
<div class="section-divider">
  <i class="bi bi-arrow-down-circle"></i>
</div>

<section class="py-5">
  <div class="container">
    <h4 class="fw-bold text-center mb-4">Artistes en vedette</h4>
    <div class="row g-4 justify-content-center">
      {% for artiste in artistes|slice:":4" %}
      <div class="col-md-3 text-center">
        <img src="{{ artiste.photo.url }}" alt="{{ artiste.nom }}" class="rounded-circle shadow" width="120" height="120" style="object-fit: cover;">
        <h6 class="mt-3 fw-bold">{{ artiste.nom }} {{ artiste.prenom }}</h6>
        <p class="text-muted small">{{ artiste.biographie|truncatewords:15 }}</p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Transition -->
  <div class="section-divider">
    <i class="bi bi-stars"></i>
  </div>


<!-- ===== SECTION PRINCIPALE (TOUTES LES ≈íUVRES) ===== -->
<section id="expo-detail" class="container py-5">
  <h2 class="fw-bold mb-4">≈íuvres pr√©sent√©es</h2>

  <div class="row g-4">
    {% for oeuvre in oeuvres %}
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        {% if oeuvre.image_principale %}
        <img src="{{ oeuvre.image_principale.url }}" class="card-img-top" alt="{{ oeuvre.titre }}">
        {% endif %}
        <div class="card-body">
          <h5 class="card-title">{{ oeuvre.titre }}</h5>
          <p class="card-text">{{ oeuvre.description|truncatewords:40 }}</p>
          <p><strong>Artiste :</strong> {{ oeuvre.artiste.prenom }} {{ oeuvre.artiste.nom }}</p>

         {% comment %}  {% if oeuvre.fichier_3d %}
          <div class="mt-3">
            <label><strong>Visualisation 3D :</strong></label>
            <model-viewer
                src="{{ oeuvre.fichier_3d.url }}"
                alt="{{ oeuvre.titre }}"
                auto-rotate
                camera-controls
                ar
                style="width: 100%; height: 400px; background-color: #f4f4f4;">
            </model-viewer>
          </div>
          {% endif %} {% endcomment %}
          
         
          

          <div class="text-center mt-3">
          {% if user.is_authenticated %}
            <button class="btn btn-like" data-oeuvre="{{ oeuvre.id }}">
              {% if oeuvres_likes|dict_key:oeuvre.id %}
                ‚ù§Ô∏è
              {% else %}
                ü§ç
              {% endif %}
              <span class="like-count">{{ oeuvre.likes.count }}</span>
            </button>
          {% else %}
            <p><a href="{% url 'galerie:login' %}">Connectez-vous</a> pour aimer cette ≈ìuvre.</p>
          {% endif %}
          </div>
          <script>
          document.querySelectorAll('.btn-like').forEach(button => {
            button.addEventListener('click', function() {
              const oeuvreId = this.dataset.oeuvre;
              const csrfToken = '{{ csrf_token }}';
              const btn = this;

              fetch(`/oeuvre/${oeuvreId}/like/`, {
                method: 'POST',
                headers: {
                  'X-CSRFToken': csrfToken,
                  'X-Requested-With': 'XMLHttpRequest'
                }
              })
              .then(response => response.json())
              .then(data => {
                if (data.liked) {
                  btn.innerHTML = `‚ù§Ô∏è <span class="like-count">${data.total_likes}</span>`;
                } else {
                  btn.innerHTML = `ü§ç <span class="like-count">${data.total_likes}</span>`;
                }
              })
              .catch(error => console.error('Erreur:', error));
            });
          });
          </script>


            


          <div class="text-center mt-3">
            <a href="{% url 'galerie:detail_oeuvre' oeuvre.id %}" class="btn btn-oeuvre">
              <i class="bi bi-eye-fill me-2"></i> Voir l‚Äô≈ìuvre
            </a>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
      <p class="text-center text-muted">Aucune ≈ìuvre disponible pour cette exposition.</p>
    {% endfor %}
  </div>

  <div id="oeuvresCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">
    {% for oeuvre in oeuvres %}
    <div class="carousel-item {% if forloop.first %}active{% endif %}">
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
        {% if oeuvre.image_principale %}
        <img src="{{ oeuvre.image_principale.url }}" class="d-block w-100" alt="{{ oeuvre.titre }}" style="height: 450px; object-fit: cover;">
        {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center" style="height: 450px;">
          <span class="text-muted">Aucune image disponible</span>
        </div>
        {% endif %}
        <div class="carousel-caption d-md-block bg-dark bg-opacity-50 rounded-3 p-4 shadow-lg">
          <h5 class="fw-bold text-white">{{ oeuvre.titre }}</h5>
          <p class="text-light small">{{ oeuvre.description|truncatewords:20 }}</p>
          <a href="{% url 'galerie:detail_oeuvre' oeuvre.id %}" class="btn btn-light btn-sm mt-2">
            <i class="bi bi-eye me-2"></i>Explorer
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Contr√¥les du carousel -->
  <button class="carousel-control-prev" type="button" data-bs-target="#oeuvresCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon bg-dark rounded-circle p-3" aria-hidden="true"></span>
    <span class="visually-hidden">Pr√©c√©dent</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#oeuvresCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon bg-dark rounded-circle p-3" aria-hidden="true"></span>
    <span class="visually-hidden">Suivant</span>
  </button>

  <!-- Indicateurs -->
  <div class="carousel-indicators mt-3">
    {% for oeuvre in oeuvres %}
    <button type="button" data-bs-target="#oeuvresCarousel" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}" aria-label="Oeuvre {{ forloop.counter }}"></button>
    {% endfor %}
  </div>
</div>


  <div class="text-center mt-5">
    <a href="{% url 'galerie:liste_expositions' %}" class="btn btn-secondary btn-lg">
      <i class="bi bi-arrow-left-circle me-2"></i> Retour aux expositions
    </a>
  </div>
</section>

<!-- Script Model Viewer -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

{% endblock %}
